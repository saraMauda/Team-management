<div class="users-container">
  <h2>Manage Users</h2>

  <div class="toolbar">
    <button class="add-btn" (click)="showAddForm = !showAddForm">
      {{ showAddForm ? 'Cancel' : '+ Add User' }}
    </button>
  </div>

  <!-- 驻住 住驻转 砖转砖 -->
  <div *ngIf="showAddForm" class="add-user-form">
    <div class="form-row">
      <label>Name</label>
      <input type="text" [(ngModel)]="newUser.name" placeholder="User name" />
    </div>

    <div class="form-row">
      <label>Email</label>
      <input type="email" [(ngModel)]="newUser.email" placeholder="Email address" />
    </div>

    <div class="form-row">
      <label>Password</label>
      <input type="password" [(ngModel)]="newUser.password" placeholder="Initial password" />
    </div>

    <div class="form-row">
      <label>Role</label>
      <select [(ngModel)]="newUser.roleString">
        <option value="ROLE_EMPLOYEE">Employee</option>
        <option value="ROLE_TEAMLEADER">Team Leader</option>
        <option value="ROLE_ADMIN">Admin</option>
      </select>
    </div>

    <div class="form-actions">
      <button class="save-btn" (click)="addUser()" [disabled]="saving">
        {{ saving ? 'Saving...' : 'Save' }}
      </button>
    </div>
  </div>

  <!-- 转 砖转砖 -->
  <table class="users-table" *ngIf="users.length > 0; else noUsers">
    <thead>
      <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Email</th>
        <th>Role</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let user of users">
        <td>
         
  <img *ngIf="user.image"
       [src]="user.image.startsWith('data:') ? user.image : 'data:image/png;base64,' + user.image"
       class="profile-img"
       alt="User image" />
    <div *ngIf="!user.image" class="placeholder-img"></div>
        
        <td>{{ user.name }}</td>
        <td>{{ user.email }}</td>
        <td>{{ prettyRole(user.role) }}</td>
        <td>
          <span [class.active]="user.active" [class.inactive]="!user.active">
            {{ user.active ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td>
          <button class="edit-btn" (click)="openEdit(user)">Edit</button>
          <button class="delete-btn" (click)="deleteUser(user.id)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <ng-template #noUsers>
    <p class="no-data">No users found.</p>
  </ng-template>

  <!--  注专 -->
  <div *ngIf="showEditForm && editingUser" class="edit-overlay">
    <div class="edit-panel">
      <h3>Edit User</h3>

      <div class="edit-grid">
        <label>Name</label>
        <input type="text" [(ngModel)]="editingUser.name" />

        <label>Email</label>
        <input type="text" [(ngModel)]="editingUser.email" />

        <label>Role</label>
        <select [(ngModel)]="editingUser.roleString">
          <option value="ROLE_EMPLOYEE">Employee</option>
          <option value="ROLE_TEAMLEADER">Team Leader</option>
          <option value="ROLE_ADMIN">Admin</option>
        </select>

        <label>Status</label>
        <select [(ngModel)]="editingUser.active">
          <option [ngValue]="true">Active</option>
          <option [ngValue]="false">Inactive</option>
        </select>

        <label>Profile Image</label>
        <input type="file" (change)="onEditImageSelected($event)" />
        <img *ngIf="previewImageBase64"
             [src]="previewImageBase64"
             class="preview-img" />
      </div>

      <div class="panel-actions">
        <button class="save-btn" (click)="updateUser()" [disabled]="saving">
          {{ saving ? 'Saving...' : 'Save' }}
        </button>
        <button class="cancel-btn" (click)="cancelEdit()">Cancel</button>
      </div>
    </div>
  </div>
</div>
